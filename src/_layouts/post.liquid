---
layout: default
---

<div style="background-image: url('{{ data.image }}'); view-transition-name: post-image-{{data.id}}" class="block w-full bg-center bg-cover cover-image aspect-video {{data.class}}"></div>
<div class="w-full px-2 mx-auto mt-4 max-w-none md:max-w-3xl sm:px-4">
  <span class="date">{{ data.date | date: "%d.%m.%Y"}}</span>
  <h1 class="title-xl">{{ data.title }}</h1>
  <div class="mt-6 prose prose-invert prose-zinc max-w-none">{{ content }}</div>
  <div id="bluesky-comments" class="mt-16">
    <div id="bsky-comments-container"></div>
    <div id="no-comments-message" class="hidden">
      <h2 class="text-xl font-bold">Comments</h2>
      <p class="mt-2 text-sm">
        You can leave a comment on 
        <a href="{{ data.bluesky_uri }}" 
           class="underline" 
           target="_blank" 
           rel="noreferrer">
          Bluesky
        </a>
      </p>
    </div>
  </div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', async function() {
    try {
      // Check thread data first using author
      const params = new URLSearchParams({ author: 'simovirtanen.com' });
      const res = await fetch(
        "https://public.api.bsky.app/xrpc/app.bsky.feed.getAuthorFeed?" + params.toString(),
        {
          method: 'GET',
          headers: {
            "Accept": "application/json",
          }
        }
      );
      
      const data = await res.json();
      console.log('Author feed:', data);
      
      if (data?.feed?.length > 0) {
        // Has posts - show the comments component
        initBlueskyComments('bsky-comments-container', 'simovirtanen.com');
      } else {
        // No posts - show our custom message
        document.getElementById('bsky-comments-container').classList.add('hidden');
        document.getElementById('no-comments-message').classList.remove('hidden');
      }
    } catch (error) {
      console.error('Error:', error);
      // Show error state
      document.getElementById('bsky-comments-container').classList.add('hidden');
      document.getElementById('no-comments-message').classList.remove('hidden');
    }
  });
</script>
